<!-- /**
 * ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: EditEvent.vue
 * ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢: ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (Edit Event)
 * Input: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏≤‡∏Å API /edit-event/{id}
 * Output: ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Guest
 * ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: RAVEROJ SONTHI
 * ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏ó‡∏≥/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: 2026-02-15
 */ -->
<!-- pages/edit_event.vue -->
<template>
    <div class="text-neutral-800 font-semibold font-[Poppins] text-3xl mb-4">
        Edit Event
    </div>
    <div class="grid grid-cols-12 h-full gap-0">
        <div class="col-span-8">

            <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå -->
            <div class="grid ">
                <div class="mt-6 md:grid md:grid-cols-[3fr_200px] md:gap-8 items-stretch">
                    <!-- v-model.trim="evn_title" = ‡∏ú‡∏π‡∏Å‡∏Ñ‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ evn_title ‡πÉ‡∏ô DATA() ‡∏≠‡∏±‡∏ô‡∏ô‡∏∂‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏≠‡∏µ‡∏Å‡∏≠‡∏±‡∏ô‡∏Å‡πá‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°
                     trim = ‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤/‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ -->
                    <div>
                        <label class="text-neutral-800 font-semibold font-[Poppins] text-[16px] mb-4 ml-1">
                            Event Title <span class="text-red-500">*</span>
                        </label><br />
                        <InputPill v-model="eventTitle"
                            class="w-full h-[52px] font-medium font-[Poppins] text-[20px] text-neutral-800 border border-neutral-200 rounded-[20px] px-5"
                            :class="{ '!border-red-500 !ring-1 !ring-red-500': submitted && formErrors.eventTitle }" />

                        <p v-if="submitted && formErrors.eventTitle" class="mt-1 text-xs text-red-600 font-medium">
                            Required field
                        </p>
                    </div>


                    <!-- ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó event-->
                    <div>
                        <label class="text-neutral-800 font-semibold font-[Poppins] text-[16px]  mb-4 ml-1">
                            Event Category <span class="text-red-500">*</span>
                        </label><br />
                        <div class="relative w-full">
                            <select
                                class="appearance-none border border-neutral-200 rounded-[20px] px-[20px] w-full h-[52px] focus:outline-none focus:border-rose-400 focus:ring-2 focus:ring-rose-300 transition bg-white"
                                v-model="eventCategoryId"
                                :class="{ '!border-red-500 !ring-1 !ring-red-500': submitted && formErrors.eventCategoryId }">

                                <option :value="eventCategoryId" hidden>
                                    {{ eventCategoryName }}
                                </option>

                                <option v-for="cat in selectCategory" :value="cat.id">
                                    {{ cat.cat_name }}
                                </option>
                            </select>

                            <Icon icon="iconamoon:arrow-down-2-light"
                                class="absolute right-4 top-1/2 -translate-y-1/2 w-8 h-8 text-red-600 pointer-events-none" />
                        </div>

                        <p v-if="submitted && formErrors.eventCategoryId" class="mt-1 text-xs text-red-600 font-medium">
                            Required Select
                        </p>
                    </div>
                </div>
            </div>

            <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå -->
            <div class="mt-4">
                <label class="text-neutral-800 font-semibold font-[Poppins] text-[16px]  mb-4 ml-1">
                    Event Description <span class="text-red-500">*</span>
                </label><br />
                <textarea
                    class="border border-neutral-200 w-full h-[165px] rounded-2xl focus:outline-none focus:border-rose-400 focus:ring-2 focus:ring-rose-300 transition px-5 py-4"
                    v-model.trim="eventDescription" placeholder="Write some description... (255 words)"
                    :class="{ '!border-red-500 !ring-1 !ring-red-500': submitted && formErrors.eventDescription }"></textarea>

                <p v-if="submitted && formErrors.eventDescription" class="mt-1 text-xs text-red-600 font-medium">
                    Required field
                </p>
            </div>

            <div class="grid grid-cols-3 mt-4 gap-4">

                <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô -->
                <div class="">
                    <label class="text-neutral-800 font-semibold font-[Poppins] text-[16px]  mb-4 ml-1">
                        Date <span class="text-red-500">*</span>
                    </label><br>
                    <div class="relative w-full">
                        <input class="border border-neutral-200 w-full h-[52px] rounded-2xl
                        focus:outline-none focus:border-rose-400 focus:ring-2 focus:ring-rose-300 transition
                        px-5 py-4
                        [&::-webkit-calendar-picker-indicator]:hidden
                        [&::-webkit-inner-spin-button]:hidden
                        [&::-webkit-clear-button]:hidden" type="date" v-model="eventDate" :min="minDate"
                            :class="{ '!border-red-500 !ring-1 !ring-red-500': submitted && formErrors.eventDate }"
                            @click="$event.target.showPicker()">


                        <Icon icon="stash:DATA-date-solid"
                            class="ml-20 w-7 h-[30px] text-red-700 shrink-0 absolute right-5 top-1/2 -translate-y-1/2  pointer-events-none" />
                    </div>
                    <p v-if="submitted && formErrors.eventDate" class="mt-1 text-xs text-red-600 font-medium">
                        'Required date'
                    </p>
                </div>

                <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ -->
                <div class="">
                    <label class="text-neutral-800 font-semibold font-[Poppins] text-[16px]  mb-4 ml-1">
                        Time <span class="text-red-500">*</span>
                    </label>
                    <div class="flex h-[52px] w-full items-center gap-1 rounded-2xl border border-neutral-200 shadow-sm px-5 py-4"
                        :class="{ '!border-red-500 !ring-1 !ring-red-500': submitted && (formErrors.eventTimeStart || formErrors.eventTimeEnd) }">
                        <!-- Time Start -->
                        <div class="flex items-center justify-center">
                            <input type="time" v-model="eventTimeStart" step="300"
                                class="time-input w-auto bg-transparent text-[16px]  font-medium text-neutral-800 outline-none text-center"
                                @click="$event.target.showPicker()" />
                            <span class="text-[16px]  font-medium text-neutral-800 ml-2"></span>

                        </div>

                        <span class="mx-1 text-[18px] font-bold text-red-600">:</span>
                        <!-- Time End -->
                        <div class="flex items-center justify-center">
                            <input type="time" v-model="eventTimeEnd" step="300"
                                class="time-input w-auto bg-transparent text-[16px]  font-medium text-neutral-800 outline-none text-center"
                                @click="$event.target.showPicker()" />
                            <span class="text-[16px]  font-medium text-neutral-800 ml-2"></span>
                        </div>
                        <div>
                            <span class="text-red-700">
                                <Icon icon="iconamoon:clock-light" class="h-6 w-6" />
                            </span>
                        </div>
                    </div>

                    <p v-if="submitted && (formErrors.eventTimeStart || formErrors.eventTimeEnd)"
                        class="mt-1 text-xs text-red-600 font-medium">
                        {{ formErrors.timeMsg || 'Require Time' }}
                    </p>

                </div>


                <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ -->
                <div>
                    <label class="text-neutral-800 font-semibold font-[Poppins] text-[16px]  mb-4 ml-1">Duration</label>
                    <div class="flex h-[52px] w-full items-center gap-3 rounded-xl  px-4 shadow-sm bg-[#F5F5F5]">
                        <input class=" w-full h-[52px] bg-transparent outline-none text-neutral-500" disabled
                            v-model="eventDuration" placeholder="Auto fill Hour"></input>
                        <Icon icon="mingcute:time-duration-line" class="w-7 h-7  text-neutral-400" />
                    </div>
                </div>
            </div>

            <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà-->
            <div class="mt-4">
                <label class="text-neutral-800 font-semibold font-[Poppins] text-[16px]  mb-4 ml-1">
                    Location <span class="text-red-500">*</span>
                </label><br>
                <InputPill v-model="eventLocation" class="w-full h-[52px] font-medium font-[Poppins] text-[20px] text-neutral-800
             border border-neutral-200 rounded-[20px] px-5"
                    :class="{ '!border-red-500 !ring-1 !ring-red-500': submitted && formErrors.eventLocation }" />

                <p v-if="submitted && formErrors.eventLocation" class="mt-1 text-xs text-red-600 font-medium">
                    Required field
                </p>
            </div>

        </div>

        <!-- Upload attachments -->
        <div class="col-span-4 m-5">
            <h3 class="text-[17px] font-semibold text-neutral-800">Upload attachments</h3>
            <p class="text-sm text-neutral-800 mb-2">Drag and drop document to your support task</p>

            <!-- ‚ñº Drop zone -->
            <div class="group relative rounded-2xl border-2 border-dashed border-red-700 bg-red-100 p-6 transition-all"
                :class="{ 'ring-2 ring-rose-300 bg-rose-100': dragging }" @dragover.prevent="dragging = true"
                @dragleave.prevent="dragging = false" @drop.prevent="onDrop">
                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå (‡πÄ‡∏î‡∏¥‡∏° + ‡πÉ‡∏´‡∏°‡πà) ‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏á‡∏°‡∏≤ -->
                <div v-if="hasAnyFiles" class="mb-4 space-y-2">
                    <div v-for="item in uploadItems" :key="item.key"
                        class="w-full flex items-center justify-between rounded-2xl bg-white border border-neutral-200 px-4 py-3 shadow-sm">
                        <div class="flex items-center gap-3 min-w-0">
                            <div class="flex h-8 w-8 items-center justify-center rounded-md ">
                                <Icon icon="basil:file-solid" class="h-10 w-10 text-red-700" />
                            </div>

                            <!-- ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå, ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
                            <template v-if="item.kind === 'EXISTING'">
                                <a :href="item.url" target="_blank" rel="noopener"
                                    class="truncate text-[16px]  text-red-700 hover:underline">
                                    {{ item.name }}
                                </a>
                                <!-- <span class="ml-2 shrink-0 text-xs text-neutral-500">({{ prettySize(item.size)
                                }})</span> -->
                            </template>
                            <template v-else>
                                <span class="truncate text-[16px]  text-neutral-800">{{ item.name }}</span>
                                <!-- <span class="ml-2 shrink-0 text-xs text-neutral-500">({{ prettySize(item.size)
                                }})</span> -->
                            </template>
                        </div>

                        <button type="button"
                            class="inline-flex h-7 w-7 items-center justify-center rounded-full text-neutral-600 hover:bg-neutral-100"
                            @click="item.kind === 'EXISTING' ? removeExisting(item.id) : removeFile(item.index)"
                            aria-label="Remove file" title="Remove">
                            ‚úï
                        </button>
                    </div>
                </div>

                <!-- ‡πÄ‡∏°‡∏Ü + ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô ‚Äú‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡∏¢‚Äù -->
                <div v-else class="flex flex-col items-center justify-center text-center min-h-[260px]">
                    <Icon icon="ep:upload-filled" class="w-40 h-28 mb-3 text-red-300" />
                    <p class="text-[16px]  font-medium text-neutral-800">Choose a file or drag &amp; drop it here</p>
                    <p class="mt-1 text-sm text-neutral-800">pdf, txt, docx, jpeg, xlsx, png</p>
                </div>

                <!-- ‡∏õ‡∏∏‡πà‡∏° Browse: ‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏™‡∏°‡∏≠ -->
                <div class="flex justify-center mt-1 mb-12">
                    <button type="button"
                        class="inline-flex items-center rounded-[10px] border  bg-white border-rose-500 px-2 py-1  text-neutral-800 hover:bg-rose-50 active:bg-rose-100"
                        @click="pickFiles">
                        <span class="text-sm font-medium">Browse files</span>
                    </button>
                </div>

                <!-- error (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) -->
                <!-- <p v-if="uploadError" class="mt-2 text-xs text-red-600 text-center">{{ uploadError }}</p> -->

                <!-- input file (‡∏ã‡πà‡∏≠‡∏ô) -->
                <input ref="fileInput" type="file" multiple class="hidden"
                    accept=".pdf,.txt,.doc,.docx,.jpg,.jpeg,.png,.xlsx,.xls" @change="onPick" />
            </div>
        </div>
    </div>

    <div class="mt-6">
        <h3 class="text-3xl font-semibold">Add Guest</h3>

        <div class="mt-4 flex flex-col gap-3">
            <div class="flex flex-wrap items-center gap-3 w-full">
                <div class="flex-1 min-w-[260px]">
                    <SearchBar v-model="search" placeholder="Search ID / Name / Nickname" @search="() => (page = 1)"
                        class="" />
                </div>

                <div class="flex flex-row flex-wrap items-center gap-2 mt-8">
                    <EmployeeDropdown label="Company ID" v-model="selectedCompanyIds" :options="companyIdOptions" />
                    <EmployeeDropdown label="Department" v-model="selectedDepartmentIds" :options="departmentOptions" />
                    <EmployeeDropdown label="Team" v-model="selectedTeamIds" :options="teamOptions" />
                    <EmployeeDropdown label="Position" v-model="selectedPositionIds" :options="positionOptions" />
                </div>
            </div>
        </div>

        <div class="mt-6">
            <DATATable :rows="pagedEmployees" :columns="columns" :loading="loadingEmployees"
                :totalItems="FILTEREDEmployees.length" v-model:page="page" v-model:pageSize="perPage"
                :pageSizeOptions="[10, 25, 50]" :selectable="true" :showRowNumber="true" rowKey="id"
                :modelValue="selectedIdsArr" @update:modelValue="onUpdateSelected" :rowClass="rowClass"
                :isRowDisabled="(row) => lockedIds.has(row.id)">
                <template #cell-fullname="{ row }">
                    {{
                        (row.emp_firstname || "") +
                        " " +
                        (row.emp_lastname || "")
                    }}
                </template>
                <template #empty>
                    <div class="py-8 text-center text-neutral-400">
                        ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                    </div>
                </template>
            </DATATable>
        </div>
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å / ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô -->

    <!-- ‡πÅ‡∏ñ‡∏ö‡∏õ‡∏∏‡πà‡∏° -->
    <div class="mt-10 w-full flex flex-row justify-between items-center border-t border-neutral-100 pt-8">
        <div class="flex-none">
            <button type="button" @click="onCancel" :disabled="saving"
                class="inline-flex items-center justify-center gap-2 rounded-[20px] px-4 bg-[#C10008] text-white font-semibold hover:bg-red-700 w-[140px] h-[48px] transition shadow-sm">
                <Icon icon="ic:baseline-plus" class="w-5 h-5 text-white rotate-45" />
                <span>Cancel</span>
            </button>
        </div>

        <div class="flex-none">
            <button type="button" @click="saveEvent" :disabled="saving"
                class="inline-flex items-center justify-center gap-2 rounded-[20px] px-4 bg-[#00A73D] text-white font-semibold hover:bg-green-700 w-[140px] h-[48px] transition shadow-sm">
                <Icon icon="ic:baseline-plus" class="w-5 h-5 text-white" />
                <span>Confirm</span>
            </button>
        </div>
    </div>
    <ModalAlert v-model:open="alert.open" :type="alert.type" :title="alert.title" :message="alert.message"
        :showCancel="alert.showCancel" :okText="alert.okText" :cancelText="alert.cancelText" @confirm="alert.onConfirm"
        @cancel="alert.onCancel" />

</template>

<script>
import axios from 'axios';
import InputPill from '@/components/Input/InputPill.vue';
import SearchBar from "@/components/SearchBar.vue";
import { Icon } from '@iconify/vue'
import DropdownPill from '@/components/Input/DropdownPill.vue'
import DATATable from '@/components/DATATable.vue'
import ModalAlert from '@/components/Alert/ModalAlert.vue'
import EmployeeDropdown from "@/components/EmployeeDropdown.vue";

export default {
    components: { InputPill, Icon, SearchBar, DropdownPill, DATATable, CancelButton, ModalAlert, EmployeeDropdown },
    DATA() {
        return {
            // --- Form DATA ---
            eventTitle: '',
            eventCategoryName: '',
            eventCategoryId: '',
            selectCategory: [],
            eventDescription: '',
            eventDate: '',
            eventTimeStart: '',
            eventTimeEnd: '',
            eventDuration: 0,
            eventLocation: '',
            saving: false,
            eventDurationMinutes: 0,

            // --- Validation ---
            formErrors: {},
            submitted: false,

            // --- Files ---
            filesExisting: [],
            filesNew: [],
            filesDeleted: [],
            dragging: false,

            // --- Table & Filter DATA ---
            employees: [],
            loadingEmployees: false,
            search: '',
            searchDraft: '',

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà HTML‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ (v-model)
            selectedCompanyIds: [],
            selectedDepartmentIds: [],
            selectedTeamIds: [],
            selectedPositionIds: [],

            // Options ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dropdown
            companyIdOptions: [],
            departmentOptions: [],
            teamOptions: [],
            positionOptions: [],

            // Selected & Locked Logic
            selectedIds: new Set(),
            lockedIds: new Set(), // ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏ä‡∏¥‡∏ç‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏Å‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)

            // Pagination
            page: 1,
            perPage: 10,

            // Alert Config
            alert: {
                open: false,
                type: 'confirm',
                title: '',
                message: '',
                showCancel: false,
                okText: 'OK',
                cancelText: 'Cancel',
                onConfirm: null,
                onCancel: null,
            },
        };
    },
    methods: {
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å backend ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
        async fetchDATA() {
            try {
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API GET /edit-event/{id} ‡πÇ‡∏î‡∏¢ {id} ‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å route param
                const EVENT_RESPONSE = await axios.get(`/edit-event/${this.$route.params.id}`) //EVENT_RESPONSE ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• json ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å fuction edit-event ‡∏ö‡∏ô route
                // console.log(EVENT_RESPONSE) //‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• json

                const PAYLOAD = EVENT_RESPONSE.DATA      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ PAYLOAD ‡∏≠‡∏µ‡∏Å 1 ‡∏ï‡∏±‡∏ß‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞ DATA
                const DATA = PAYLOAD?.event ?? {}      // DATA ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏à‡∏≤‡∏Å PAYLOAD ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏±‡∏ô null

                const RESPONSE = await axios.get('/CATEGORIES')
                const CATEGORIES = RESPONSE.DATA?.DATA ?? []

                this.eventCategoryId = DATA?.evn_category_id ?? ''   //‡πÄ‡∏Å‡πá‡∏ö
                //‡πÄ‡∏≠‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å controller ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤ ‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÉ‡∏ô DATA()
                // ‡πÄ‡∏≠‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤ map ‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà bind ‡∏Å‡∏±‡∏ö input/textarea
                this.eventTitle = DATA?.evn_title ?? '' // ‡∏ñ‡πâ‡∏≤ DATA ‡∏´‡∏£‡∏∑‡∏≠ DATA.evn_title ‡πÄ‡∏õ‡πá‡∏ô undefined ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ '' ‡πÅ‡∏ó‡∏ô
                this.eventDescription = DATA?.evn_description ?? ''
                this.eventCategoryName = DATA?.cat_name ?? ''
                this.eventDate = DATA.evn_date.split("T")[0]; //‡πÄ‡∏≠‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏°‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡πÅ‡∏õ‡∏•‡∏á format ‡πÄ‡∏õ‡πá‡∏ô "yyyy-MM-dd".‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å
                //spit(T) ‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô array 2 ‡∏ä‡πà‡∏≠‡∏á ‡∏à‡∏∞‡πÑ‡∏î‡πâ ["2023-08-01", "00:00:00.000000Z"] ‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡∏ö "2023-08-01T00:00:00.000000Z".split("T")

                this.eventTimeStart = DATA?.evn_timestart ?? ''
                this.eventTimeEnd = DATA?.evn_timeend ?? ''
                this.eventLocation = DATA?.evn_location ?? ''
                this.selectCategory = CATEGORIES

                //  ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°
                this.filesExisting = PAYLOAD?.files ?? [] //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• files ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å controller


                //  ‡πÄ‡∏≠‡∏≤ Guest ID ‡πÄ‡∏î‡∏¥‡∏° ‡∏°‡∏≤‡πÉ‡∏™‡πà Set ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Checkbox ‡∏ï‡∏¥‡πä‡∏Å‡∏ñ‡∏π‡∏Å
                const EXISTINGGUESTS = PAYLOAD?.guest_ids ?? []
                const GUESTSMAPPED = EXISTINGGUESTS.map(id => parseInt(id))

                this.selectedIds = new Set(GUESTSMAPPED) // ‡∏ï‡∏¥‡πä‡∏Å‡∏ñ‡∏π‡∏Å
                this.lockedIds = new Set(GUESTSMAPPED) // üîí ‡∏•‡πá‡∏≠‡∏Å‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ


                // 1) ‡πÇ‡∏´‡∏•‡∏î metaDATA ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô/‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå
                this.loadingEmployees = true
                const INFO = await axios.get('/event-INFO')
                const EMPLOYEE_DATA = INFO.DATA || {}

                // [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 1] Map ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Create (‡πÄ‡∏û‡∏¥‡πà‡∏° Logic Company ID)
                this.employees = (EMPLOYEE_DATA.employees || []).map(employee => {
                    // Logic ‡∏´‡∏≤ Company ‡∏à‡∏≤‡∏Å ID (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Create)
                    const RAW_ID = String(employee.emp_id || employee.code || "");
                    const RAW_PREFIX_FROM_ID = (RAW_ID.match(/^[A-Za-z]+/) || [""])[0];
                    const COMPANY_FILTER = (RAW_PREFIX_FROM_ID || "").toUpperCase();

                    return {
                        id: employee.id,
                        // ‡πÉ‡∏ä‡πâ emp_id ‡∏´‡∏£‡∏∑‡∏≠ code ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà Backend ‡∏™‡πà‡∏á‡∏°‡∏≤
                        emp_id: RAW_ID,
                        emp_firstname: employee.emp_firstname || employee.first_name || '',
                        emp_lastname: employee.emp_lastname || employee.last_name || '',
                        fullname: `${employee.emp_firstname || ''} ${employee.emp_lastname || ''}`, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏ß‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                        nickname: employee.emp_nickname || '',
                        department: employee.department_name || '',
                        team: employee.team_name || '',
                        position: employee.position_name || '',
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏° Company Field ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ Filter
                        COMPANY_FILTER: COMPANY_FILTER,
                        companyId: employee.company_id || COMPANY_FILTER || "",
                    }
                })
                this.buildFilterOptions()

                this.loadingEmployees = false
            } catch (err) {
                // ‡∏ñ‡πâ‡∏≤ error ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏ô console + set ‡∏Ñ‡πà‡∏≤
                console.error(err)
                this.eventTitle = '(‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)'
            }
        },
        toOptions(arr) {
            const UNIQ = [...new Set(arr.filter(Boolean))].sort();
            return UNIQ.map((v) => ({ label: v, value: v }));
        },

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Filter ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Employees ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
        buildFilterOptions() {
            // Company
            this.companyIdOptions = this.toOptions(
                this.employees.map((r) => r.companyId)
            );
            // Department
            this.departmentOptions = this.toOptions(
                this.employees.map((r) => r.department)
            );
            // Team
            this.teamOptions = this.toOptions(
                this.employees.map((r) => r.team)
            );
            // Position
            this.positionOptions = this.toOptions(
                this.employees.map((r) => r.position)
            );
        },

        // ‡∏ã‡∏µ‡∏î‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏ß‡πâ
        rowClass(row) {
            if (this.lockedIds.has(row.id)) {
                // ‡πÄ‡∏ï‡∏¥‡∏° ! ‡∏´‡∏ô‡πâ‡∏≤ bg-neutral-300 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ó‡∏±‡∏ö‡∏™‡∏µ‡πÅ‡∏î‡∏á (Force Override)
                return ' pointer-events-none !bg-neutral-300 select-none'
            }
            return ''
        },

        // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å DATATable ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ä‡πá‡∏Ñ
        onUpdateSelected(nextArr) {
            const FILTERED = nextArr.filter(id => !this.lockedIds.has(id))
            this.selectedIds = new Set(FILTERED)
        },
        pickFiles() { this.$refs.fileInput?.click?.() },
        //<input ref="fileInput" ... style="display:none" /> ‚Üí ‡∏ä‡πà‡∏≠‡∏á input hidden ‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏•‡∏≠‡∏î ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô input ‡πÉ‡∏ï‡πâ browsefile

        // ‡∏û‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "Browse files" ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å pickFiles()

        // this.$refs.fileInput.click() ‚Üí ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£ "‡∏Ñ‡∏•‡∏¥‡∏Å" ‡∏ó‡∏µ‡πà input ‡πÅ‡∏ö‡∏ö‡∏ã‡πà‡∏≠‡∏ô

        // Browser ‡∏à‡∏∞‡πÄ‡∏î‡πâ‡∏á File Picker (‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£) ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå

        // ‡∏û‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à ‚Üí trigger event @change="onPick" ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô onPick(file) ‡∏°‡∏≤‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢


        onPick(file) { this.addFiles([...file.target.files]); file.target.value = '' },
        // ‡∏û‡∏≠‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß ([...file.target.files]) ‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô filelist ‡πÄ‡∏õ‡πá‡∏ô array ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ add files ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ arary ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏≠‡∏∞‡∏Å‡∏ß‡πà‡∏≤

        onDrop(event) { this.dragging = false; this.addFiles([...event.DATATransfer.files]) },
        //‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ dragging (‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å set true ‡∏ï‡∏≠‡∏ô @dragover) ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö css ‡∏ï‡∏≠‡∏ô‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á

        //this.addFiles([...event.DATATransfer.files])
        // ‡∏™‡πà‡∏á array ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏´‡πâ method addFiles()
        // [...event.DATATransfer.files] ‡πÉ‡∏ä‡πâ spread operator ... ‡πÅ‡∏õ‡∏•‡∏á FileList ‚Üí array ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á (File[])

        //flow
        //‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á ‚Üí trigger @drop="onDrop"
        // onDrop ‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ ‚Üí ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô array ‚Üí ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà addFiles
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‚Üí ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô filesNew ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô < ul v -for= "newFile in filesNew" >

        addFiles(list) {  //‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠ list
            const MAX_FILE_SIZE_MB = 50;

            const ALLOW = [
                "application/pdf", "text/plain", "application/msword",
                "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                "image/jpeg", "image/png",
                "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                "application/vnd.ms-excel",
            ]
            const ERRORS = []
            list.forEach(file => { //‡πÄ‡∏≠‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏£‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏´‡∏°
                if (file.size > MAX_FILE_SIZE_MB * 1024 * 1024) ERRORS.push(`${file.name}: ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡∏¥‡∏ô ${MAX_FILE_SIZE_MB}MB`)
                else if (!ALLOW.includes(file.type)) ERRORS.push(`${file.name}: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö`)
                else this.filesNew.push(file) //‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Å‡πá‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ filesNew ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô array
            })
            if (ERRORS.length) {
    this.openAlert({
        type: 'error',
        title: 'UPLOAD ERROR',
        message: ERRORS.join('\n')
    })
}
 //‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡πÅ‡∏™‡∏î‡∏á alert
        },

        removeFile(index) { this.filesNew.splice(index, 1) },

        removeExisting(id) { //‡∏£‡∏±‡∏ö id ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏°‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß  filter(file => file.id === id) ‡∏Ñ‡∏∑‡∏≠ ‡∏ß‡∏ô‡∏•‡∏π‡∏õ ‡∏´‡∏≤ id ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•array ‡∏Ç‡∏≠‡∏áfilesExisting
            this.filesExisting = this.filesExisting.filter(file => file.id !== id)
            this.filesDeleted.push(id) //‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Id ‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ fileDeleted

        },
        //‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå
        prettySize(byte) { const MB = byte / (1024 * 1024); return MB >= 1 ? `${MB.toFixed(2)} MB` : `${(byte / 1024).toFixed(0)} KB` },
        //byte / (1024 * 1024); return mb >= 1 ? ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î ‚â• 1 MB ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô MB ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î < 1 MB ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô KB
        //mb.toFixed(2) = ‡∏õ‡∏±‡∏î‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
        //${(byte / 1024).toFixed(0)} KB ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 MB ‚Üí ‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô KB ‡πÅ‡∏ó‡∏ô


        resetSearch() { //reset ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà search ‡∏°‡∏≤
            this.search = '';
            this.searchDraft = '';

            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Array ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
            this.selectedCompanyIds = [];
            this.selectedDepartmentIds = [];
            this.selectedTeamIds = [];
            this.selectedPositionIds = [];

            this.page = 1;
        },

        toggleOne(id, event) {

            // 1. ‡∏ñ‡πâ‡∏≤ id ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô lockedIds (‡πÅ‡∏Ç‡∏Å‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
            if (this.lockedIds.has(id)) { event?.preventDefault?.(); return }// ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å event checkbox ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡πä‡∏Å‡πÑ‡∏î‡πâ
            const SELECTED = new Set(this.selectedIds) // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Set ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å selectedIds (‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà)

            // 3. ‡∏ñ‡πâ‡∏≤ checkbox ‡∏ï‡∏¥‡πä‡∏Å‡∏≠‡∏¢‡∏π‡πà ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏° id ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ
            //    ‡∏ñ‡πâ‡∏≤‡πÄ‡∏≠‡∏≤‡∏ï‡∏¥‡πä‡∏Å‡∏≠‡∏≠‡∏Å ‚Üí ‡∏•‡∏ö id ‡∏≠‡∏≠‡∏Å
            if (event.target.checked) SELECTED.add(id);
            else SELECTED.delete(id)
            // 4. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ selectedIds ‡∏î‡πâ‡∏ß‡∏¢ Set ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà
            this.selectedIds = SELECTED
        },

        toggleAllOnPage(event) {
            const TICK = event.target.checked // true = ‡∏ï‡∏¥‡πä‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î, false = ‡πÄ‡∏≠‡∏≤‡∏ï‡∏¥‡πä‡∏Å‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const SELECTED = new Set(this.selectedIds) // ‡∏™‡∏£‡πâ‡∏≤‡∏á Set ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å selectedIds (‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà)
            // ‡∏ß‡∏ô‡∏à‡∏ô‡∏Ñ‡∏£‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏ä‡∏ß‡πå‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            this.pagedEmployees.forEach(employee => {

                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô ‡πÇ‡∏î‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°
                if (this.lockedIds.has(employee.id)) return

                // ‡∏ñ‡πâ‡∏≤ tick = true ‚Üí add id
                // ‡∏ñ‡πâ‡∏≤ tick = false ‚Üí remove id
                if (TICK) SELECTED.add(employee.id); else SELECTED.delete(employee.id)
            })

            // 4. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ selectedIds ‡∏î‡πâ‡∏ß‡∏¢ Set ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà
            this.selectedIds = SELECTED
        },


        validateForm() {
            const ERRORS = {};

            if (!this.eventTitle?.trim()) ERRORS.eventTitle = true;
            if (!this.eventCategoryId) ERRORS.eventCategoryId = true;
            if (!this.eventDescription?.trim()) ERRORS.eventDescription = true;
            if (!this.eventDate) ERRORS.eventDate = true;



            // Check Required
            if (!this.eventTimeStart) ERRORS.eventTimeStart = true;
            if (!this.eventTimeEnd) ERRORS.eventTimeEnd = true;
            if (!this.eventLocation?.trim()) ERRORS.eventLocation = true;



            this.formErrors = ERRORS;
            return Object.keys(ERRORS).length === 0;
        },

        async saveEvent() {
            this.submitted = true;

            if (!this.validateForm()) {
                // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏ä‡∏ß‡πå‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏ï‡∏≤‡∏° state
                return;
            }

            this.openAlert({
                type: 'confirm',
                title: 'ARE YOU SURE TO EDIT?',
                message: 'Are you sure you want to change this?',
                showCancel: true,
                okText: 'OK',
                cancelText: 'Cancel',
                onConfirm: async () => {
                    try {
                        this.saving = true

                        const ID = this.$route.params.id
                        const FORM_DATA = new FORM_DATA()
                        FORM_DATA.append('id', ID)
                        FORM_DATA.append('evn_title', this.eventTitle?.trim() || '')

                        if (this.eventCategoryId)
                            FORM_DATA.append('evn_category_id', String(this.eventCategoryId))

                        FORM_DATA.append('evn_description', this.eventDescription ?? '')
                        FORM_DATA.append('evn_date', this.eventDate)
                        FORM_DATA.append('evn_timestart', this.eventTimeStart)
                        FORM_DATA.append('evn_timeend', this.eventTimeEnd)
                        FORM_DATA.append('evn_location', this.eventLocation)
                        FORM_DATA.append('evn_duration', String(this.eventDurationMinutes || 0))

                        //  ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà (‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏Å/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏≤)
                        if (this.filesNew.length > 0) {
                            this.filesNew.forEach((file) => {
                                FORM_DATA.append('attachments[]', file)
                            })
                        }

                        //  ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
                        if (this.filesDeleted.length > 0) {
                            this.filesDeleted.forEach((id) => {
                                FORM_DATA.append('delete_file_ids[]', id)
                            })
                        }

                        // Guest ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (optional)
                        // ‡πÅ‡∏Ç‡∏Å (‡∏£‡∏ß‡∏°‡πÅ‡∏Ç‡∏Å‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å)
                        this.selectedIdsForSubmit.forEach(empId =>
                            FORM_DATA.append('employee_ids[]', empId)
                        );

                        const res = await axios.post('/edit-event', FORM_DATA, {
                            headers: { 'Accept': 'application/json' },
                        })
                        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ Warning ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏°‡∏•‡πÑ‡∏´‡∏°?
                        if (res.DATA.mail_warning) {
                            this.openAlert({
                                type: 'warning', // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á
                                title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÅ‡∏ï‡πà‡∏™‡πà‡∏á‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)',
                                message: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á: ' + res.DATA.mail_warning,
                                okText: 'OK',
                                onConfirm: () => this.$router.back(),
                            })
                        } else {
                            // ‡∏Å‡∏£‡∏ì‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)
                            this.openAlert({
                                type: 'success',
                                title: 'EDIT SUCCESS!',
                                message: 'This event has been successfully edited.',
                                okText: 'OK',
                                onConfirm: () => this.$router.back(),
                            })
                        }

                        this.openAlert({
                            type: 'success',
                            title: 'EDIT SUCCESS!',
                            message: 'This event has been successfully edited.',
                            okText: 'OK',
                            onConfirm: () => this.$router.back(),
                        })
                    } catch (err) {
                        this.openAlert({
                            type: 'error',
                            title: 'EDIT FAILED!',
                            message: err.RESPONSE?.DATA?.message || 'An error occurred.',
                        })
                    } finally {
                        this.saving = false
                    }
                },
            })
        },

        calculateDuration() {
            const [START_HOUR, START_MINUTE] = (this.eventTimeStart || '0:0').split(':').map(Number); //‡πÅ‡∏¢‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏£‡∏á‡∏™‡πà‡∏ß‡∏ô : ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Å‡∏±‡∏ö ‡∏ô‡∏≤‡∏ó‡∏µ
            // START_HOUR ‡πÄ‡∏Å‡πá‡∏ö ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á START_MINUTE ‡πÄ‡∏Å‡πá‡∏ö‡∏ô‡∏≤‡∏ó‡∏µ
            //‡πÄ‡∏≠‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞ element ‡πÉ‡∏ô array ‡πÑ‡∏õ‡∏ú‡πà‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Number() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å string ‚Üí number :  ["09", "30"].map(Number) ‚Üí [9, 30]
            const [END_HOUR, END_MINUTE] = (this.eventTimeEnd || '0:0').split(':').map(Number);

            let SUM_START_MIN = START_HOUR * 60 + START_MINUTE; //‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ
            let SUM_END_MIN = END_HOUR * 60 + END_MINUTE;
            let diff = SUM_END_MIN - SUM_START_MIN;// ‡πÄ‡∏≠‡∏≤‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ä‡πà‡∏ß‡∏á‡∏°‡∏≤‡∏•‡∏ö‡∏Å‡∏±‡∏ô
            if (diff < 0) diff += 24 * 60; // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô ‡∏ñ‡πâ‡∏≤‡∏•‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤ ‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÉ‡∏´‡πâ diff ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ 24 ‡∏ä‡∏° ‡πÅ‡∏ö‡∏ö‡∏ô‡∏≤‡∏ó‡∏µ


            this.eventDurationMinutes = Math.max(0, diff); //‡∏Å‡∏±‡∏ô bug ‡πÄ‡∏û‡∏∑‡πà‡∏≠ diff ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏ï‡∏¥‡∏î‡∏•‡∏ö ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤ 0 ‡πÅ‡∏ó‡∏ô

            // ‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏ä‡∏ß‡πå ‡πÉ‡∏ô input :
            const HOUR = Math.floor(diff / 60), //hour ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏° ‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏à‡∏≤‡∏Ådiff ‡πÄ‡∏®‡∏©‡∏õ‡∏±‡∏î‡∏•‡∏á
                min = diff % 60;  //min ‡πÄ‡∏Å‡πá‡∏ö‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏≠‡∏≤‡πÄ‡∏®‡∏©
            this.eventDuration = `${HOUR} Hour ${min} Min`; // ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‚Äú‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‚Äù ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á h ‡∏ô‡∏≤‡∏ó‡∏µ m -> 2h50m
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            if (min === 0) {
                this.eventDuration = `${HOUR} Hour`;
            } else if (HOUR === 0) {
                this.eventDuration = `${min} Min`;
            }
        },
        onCancel() {
            if (this.saving || this.filesNew.length) {
                this.openAlert({
    type: 'confirm',
    title: 'ARE YOU SURE?',
    message: 'Discard all changes?',
    showCancel: true,
    onConfirm: () => this.$router.back()
})
            }
            this.$router?.back?.()  // ‡∏´‡∏£‡∏∑‡∏≠ this.$router.push('/events')
        },
        openAlert(cfg = {}) {
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï handler ‡πÄ‡∏Å‡πà‡∏≤
            this.alert.onConfirm = null
            this.alert.onCancel = null

            // ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ default
            Object.assign(this.alert, {
                open: true,
                type: 'success',
                title: '',
                message: '',
                showCancel: false,
                okText: 'OK',
                cancelText: 'Cancel',
            }, cfg)
        },
    },

    computed: {
        // --- Filtering Logic (Adapted from EventCheckIn) ---
        FILTEREDEmployees() {
            const SEARCH = (this.search || "").toLowerCase().trim();
            let list = this.employees;

            // Search Filter
            if (SEARCH) {
                list = list.filter((e) =>
                    [
                        String(e.emp_id),
                        e.emp_firstname,
                        e.emp_lastname,
                        e.nickname,
                    ].some((f) => f?.toLowerCase().includes(SEARCH))
                );
            }

            // Company Filter
            if (this.selectedCompanyIds?.length) {
                const NEEDLES = this.selectedCompanyIds
                    .map((x) => String(x).trim())
                    .filter(Boolean);
                list = list.filter((r) => {
                    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏±‡πâ‡∏á companyId ‡πÅ‡∏•‡∏∞ COMPANY_FILTER ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                    const idStr = String(
                        r.companyId || r.COMPANY_FILTER || ""
                    ).trim();
                    return NEEDLES.some((n) => idStr.includes(n));
                });
            }

            // Department Filter
            if (this.selectedDepartmentIds?.length) {
                const SET = new Set(this.selectedDepartmentIds);
                list = list.filter((r) => SET.has(r.department));
            }

            // Team Filter
            if (this.selectedTeamIds?.length) {
                const SET = new Set(this.selectedTeamIds);
                list = list.filter((r) => SET.has(r.team));
            }

            // Position Filter
            if (this.selectedPositionIds?.length) {
                const SET = new Set(this.selectedPositionIds);
                list = list.filter((r) => SET.has(r.position));
            }

            return list;
        },

        // ‡πÉ‡∏ô computed: { ... }
        isValidTimeLogic() {
            // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á * 60 + ‡∏ô‡∏≤‡∏ó‡∏µ)
            const [START_HOUR, START_MINUTE] = (this.eventTimeStart || '0:0').split(':').map(Number);
            const [END_HOUR, END_MINUTE] = (this.eventTimeEnd || '0:0').split(':').map(Number);

            const SUM_START_MIN = START_HOUR * 60 + START_MINUTE;
            const SUM_END_MIN = END_HOUR * 60 + END_MINUTE;

            // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ (‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô 00:00 ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î) ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ true ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÑ‡∏õ‡∏ï‡∏¥‡∏î validate required ‡πÅ‡∏ó‡∏ô)
            if (!this.eventTimeStart || !this.eventTimeEnd) return true;

            // [Earth (Suphanut) 2025-12-06] ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Logic: ‡∏ï‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏ß‡∏Å 24 ‡∏ä‡∏°. ‡∏≠‡∏≠‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏ö ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° ( > ) ‡∏´‡∏£‡∏∑‡∏≠ ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö ( >= ) ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà requirement (‡∏õ‡∏Å‡∏ï‡∏¥ Event ‡∏Ñ‡∏ß‡∏£ >)
            return SUM_END_MIN > SUM_START_MIN;
        },

        // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡∏≠‡∏á DATATable
        columns() {
            return [
                { key: 'emp_id', label: 'Employee ID', sortable: false, class: 'min-w-[120px] text-left' },
                { key: 'fullname', label: 'Name', sortable: false, class: 'min-w-[120px] text-left' }, // ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ú‡πà‡∏≤‡∏ô slot
                { key: 'nickname', label: 'Nickname', sortable: false, class: 'min-w-[120px] text-left' },
                { key: 'department', label: 'Department', sortable: false, class: 'min-w-[120px] text-left' },
                { key: 'team', label: 'Team', sortable: false, class: 'min-w-[120px] text-left' },
                { key: 'position', label: 'Position', sortable: false, class: 'min-w-[120px] text-left' },
            ]
        },

        empIdOptions() {
            // ‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô array ‡∏Ç‡∏≠‡∏á string ‡πÄ‡∏ä‡πà‡∏ô ["E001","E002",...]
            return [...new Set(this.employees.map(e => e.emp_id).filter(Boolean))];
        },

        hasAnyFiles() {
            return (this.filesExisting?.length || 0) + (this.filesNew?.length || 0) > 0
        },

        uploadItems() {
            const EXISTING = (this.filesExisting || []).map(f => ({
                key: `old-${f.id}`,
                kind: 'EXISTING',
                id: f.id,
                name: f.file_name,
                url: f.url,
                size: f.file_size ?? 0,
            }))
            const NEWS = (this.filesNew || []).map((f, i) => ({
                key: `new-${i}`,
                kind: 'new',
                index: i,
                name: f.name,
                size: f.size ?? 0,
            }))
            // ‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
            return [...EXISTING, ...NEWS]
        },

        // ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏ï‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏à‡∏£‡∏¥‡∏á: ‡∏£‡∏ß‡∏°‡πÅ‡∏Ç‡∏Å‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å + ‡πÅ‡∏Ç‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        selectedIdsForSubmit() {
            return Array.from(new Set([...this.lockedIds, ...this.selectedIds]));
        },

        // v-model ‡∏ó‡∏µ‡πà bind ‡∏Å‡∏±‡∏ö DATATable ‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡∏Ñ‡∏á‚Äù ‡πÅ‡∏Ç‡∏Å‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡πÄ‡∏™‡∏°‡∏≠
        selectedIdsArr: {
            get() {
                // ‡πÉ‡∏´‡πâ DATATable ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ (‡∏£‡∏ß‡∏°‡∏•‡πá‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á checkbox ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏¥‡πä‡∏Å
                return Array.from(new Set([...this.lockedIds, ...this.selectedIds]));
            },
            set(arr) {
                // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà ‚Äú‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏•‡πá‡∏≠‡∏Å‚Äù ‡∏•‡∏á selectedIds, ‡πÅ‡∏•‡∏∞‡∏ö‡∏ß‡∏Å lockedIds ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏™‡∏°‡∏≠
                const nonLocked = arr.filter(id => !this.lockedIds.has(id));
                this.selectedIds = new Set(nonLocked);
            }
        },

        totalPages() {
            return Math.ceil(this.FILTEREDEmployees.length / this.perPage)
            // this.FILTEREDEmployees.length = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏£‡∏≠‡∏á search/filter ‡πÅ‡∏•‡πâ‡∏ß

            // this.perPage = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô 10, 25, 50)

            // Math.ceil() = ‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©‡∏Ç‡∏∂‡πâ‡∏ô ‚Üí ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏•‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤
            //Ex. ‡∏°‡∏µ 47 ‡∏Ñ‡∏ô, perPage = 10 ‚Üí 47 / 10 = 4.7 ‚Üí ‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô = 5 ‡∏´‡∏ô‡πâ‡∏≤ ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏°‡∏µ 5 ‡∏´‡∏ô‡πâ‡∏≤
        },

        pagedEmployees() {
            const start = (this.page - 1) * this.perPage
            return this.FILTEREDEmployees.slice(start, start + this.perPage)

            //‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì index ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‚Üí (this.page - 1) * this.perPage

            //‡πÉ‡∏ä‡πâ.slice(start, start + this.perPage) ‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤

            // Ex page = 1, perPage = 10 ‚Üí slice(0, 10) ‚Üí ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà index 0‚Äì9 ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤

        },

        allCheckedOnPage() {
            if (this.pagedEmployees.length === 0) return false
            const UNLOCKED = this.pagedEmployees.filter(employee => !this.lockedIds.has(employee.id))
            return UNLOCKED.length > 0 && UNLOCKED.every(employee => this.selectedIds.has(employee.id))

            //‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ checkbox ‚Äú‡∏ï‡∏¥‡πä‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‚Äù ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡πä‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (length === 0) ‚Üí return false
            // UNLOCKED = ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Å (lockedIds)
            // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢:
            // UNLOCKED.length > 0 ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            // UNLOCKED.every(...) ‚Üí ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô selectedIds (‡∏Ñ‡∏∑‡∏≠‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß)

            // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ 10 ‡∏Ñ‡∏ô ‡πÅ‡∏ï‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏Ñ‡∏£‡∏ö 10 ‚Üí return true

            //‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ 10 ‡∏Ñ‡∏ô ‡πÅ‡∏ï‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ 8 ‚Üí return false
            //‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡πä‡∏Å‡∏´‡∏°‡∏î ‡πÄ‡∏õ‡πá‡∏ô true ‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡πâ checkboxall ‡∏à‡∏∞‡∏ï‡∏¥‡πä‡∏Å‡∏î‡πâ‡∏ß‡∏¢
        },

        minDate() {
            const TODAY = new Date();
            const YEAR = TODAY.getFullYear();
            const MONTH = String(TODAY.getMonth() + 1).padStart(2, '0');
            const DAY = String(TODAY.getDate()).padStart(2, '0');
            return `${YEAR}-${MONTH}-${DAY}`;
        },
    },

    watch: {
        eventTimeStart: 'calculateDuration',//‡πÄ‡∏£‡∏µ‡∏¢‡∏Å calculateDuration ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏°‡∏≤‡∏ú‡πà‡∏≤‡∏ô controller ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏≠‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Input
        eventTimeEnd: 'calculateDuration',// ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì duration ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏à‡∏≤‡∏Å controller ‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏ô‡πâ‡∏≤
        search() { this.page = 1 },

        //  Watch ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Array ‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß
        selectedCompanyIds() { this.page = 1 },
        selectedDepartmentIds() { this.page = 1 },
        selectedTeamIds() { this.page = 1 },
        selectedPositionIds() { this.page = 1 },

        perPage() { this.page = 1 },
    },
    // ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ edit_event.vue
    mounted() {
        this.fetchDATA(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fetchDATA() ‡πÄ‡∏°‡∏∑‡πà‡∏≠ component(layout.vue) ‡∏ñ‡∏π‡∏Å mount
    },

}
</script>
<style scoped>
/* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ input type="time" ‡∏î‡∏π ‚Äú‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‚Äù ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏∑‡∏ô‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏• */
.time-input::-webkit-calendar-picker-indicator {
    /* opacity: 0; */
    display: none;
}

/* ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏ö‡∏≠‡∏Å AM/PM */
/* .time-input::-webkit-datetime-edit-ampm-field {
    display: none;
} */

/* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á Chrome/Safari */
</style>
