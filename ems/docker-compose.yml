services:
  app:
    image: php:8.2-apache
    container_name: laravel_app
    ports: ["8080:80"]            
    volumes:
      - ./:/var/www/html
    environment:
      APACHE_DOCUMENT_ROOT: /var/www/html/public
    depends_on: [node]
    networks: [appnet]

  node:
    image: node:20
    container_name: vite_dev
    working_dir: /app
    command: sh -lc "([ -f package-lock.json ] && npm ci || npm i) && npm run dev -- --host 0.0.0.0 --port 5173"
    ports: ["5173:5173"]          
    environment:
      CHOKIDAR_USEPOLLING: "true" 
    volumes:
      - ./:/app
    networks: [appnet]

volumes:
  dbdata:

networks:
  appnet:
