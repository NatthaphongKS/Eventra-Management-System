version: '3'
services:
  # App (รวม Apache + PHP + Laravel Code + Vue Build ไว้หมดแล้ว)
  app:
    build: .                # สำคัญ! สั่งให้สร้าง Image จาก Dockerfile ในเครื่องนี้
    container_name: ems_app
    restart: unless-stopped
    ports:
      - "7080:80"           # เข้าเว็บผ่าน http://ip-server:7080
    volumes:
      - ./.env:/var/www/html/.env  # Map แค่ .env เพื่อให้ Config ตรงกับ Server
    networks:
      - appnet

  # Database (MySQL)
  db:
    image: mysql:8.0
    container_name: ems_db
    restart: unless-stopped
    environment:
      MYSQL_DATABASE: ${DB_DATABASE}
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
    volumes:
      - dbdata:/var/lib/mysql
    networks:
      - appnet

networks:
  appnet:
    driver: bridge

volumes:
  dbdata:
    driver: local